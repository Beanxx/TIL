2022.07.06(Wed)

[TIL] Day51 <br/>
[SEB FE] Day50

<br/>

## â˜‘ï¸Â Redux

âœ‹Â `Redux`ëŠ” `React`ì—†ì´ë„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬

### ğŸ“Â Redux ìƒíƒœ ê´€ë¦¬ ìˆœì„œ

1. ìƒíƒœê°€ ë³€ê²½ ì´ë²¤íŠ¸ ë°œìƒ â†’ ë³€ê²½ë  ìƒíƒœ ì •ë³´ê°€ ë‹´ê¸´ `Action` ê°ì²´ ìƒì„±
2. `Action` ê°ì²´ê°€ `Dispatch` í•¨ìˆ˜ ì¸ìë¡œ ì „ë‹¬
3. `Dispatch` í•¨ìˆ˜ê°€ `Action` ê°ì²´ë¥¼ `Reducer` í•¨ìˆ˜ë¡œ ì „ë‹¬
4. Reducer í•¨ìˆ˜ëŠ” Action ê°ì²´ ê°’ í™•ì¸ í›„, ê°’ì— ë”°ë¼ ì „ì—­ ìƒíƒœ ì €ì¥ì†Œì¸ `Store` ìƒíƒœ ë³€ê²½
5. ìƒíƒœê°€ ë³€ê²½ë˜ë©´, ReactëŠ” í™”ë©´ ë¦¬ë Œë”ë§

`Action` ğŸ‘‰Â `Dispatch` ğŸ‘‰Â `Reducer` ğŸ‘‰Â `Store`

ğŸ« Â `Redux`ì—ì„  ìœ„ì™€ ê°™ì€ ìˆœì„œë¡œ ë°ì´í„°ê°€ ë‹¨ë°©í–¥ìœ¼ë¡œ íë¦„

<br/>

### ğŸŒŠÂ Action

> ì–´ë–¤ ì•¡ì…˜ì„ ì·¨í•  ê²ƒì¸ì§€ ì •ì˜í•´ ë†“ì€ ê°ì²´

```jsx
// payload í•„ìš”X
{type: "INCREASE'} // typeì€ ëŒ€ë¬¸ì & Snake_Caseë¡œ ì‘ì„±í•˜ê¸°!

// payload í•„ìš”O
{type: "SET_NUMBER', payload: 10} // payloadë¡œ êµ¬ì²´ì ì¸ ê°’ ì „ë‹¬
```

âœ‹Â `type`(í•´ë‹¹ Action ê°ì²´ê°€ ì–´ë–¤ ë™ì‘ì„ í•˜ëŠ”ì§€ ëª…ì‹œ) í•„ìˆ˜ ì§€ì •!

âœ‹Â Action ê°ì²´ ìƒì„± í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ â‡’ ì•¡ì…˜ ìƒì„±ì(`Action Creator`)

```jsx
// [Action Creator]

// payload í•„ìš”X
const increase = () => {
  return {
    type: "INCREASE",
  };
};

// payload í•„ìš”O
const setNumber = (num) => {
  return {
    type: "SET_NUMBER",
    payload: num,
  };
};
```

<br/>

### ğŸŒµÂ Dispatch

> `Reducer`ë¡œ `Action`ì„ ì „ë‹¬í•´ì£¼ëŠ” í•¨ìˆ˜

```jsx
// Action ê°ì²´ ì§ì ‘ ì‘ì„±í•˜ëŠ” ê²½ìš°
dispatch({ type: "INCREASE" });
dispatch({ type: "SET_NUMBER", payload: 10 });

// Action Creator ì‚¬ìš©í•˜ëŠ” ê²½ìš°
dispatch(increase());
dispatch(setNumber(10));

// => Action ê°ì²´ë¥¼ ì „ë‹¬ë°›ì€ Dispatchí•¨ìˆ˜ëŠ” Reducer í˜¸ì¶œ
```

<br/>

### ğŸ¥€Â Reducer

> `Dispatch`ì—ê²Œì„œ ì „ë‹¬ë°›ì€ `Action`ê°ì²´ì˜ `type`ê°’ì— ë”°ë¼ì„œ ìƒíƒœë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” í•¨ìˆ˜

```jsx
const count =1;

const counterReducer = (state = count, action) { // ì¸ìë¡œ ì´ˆê¸°ìƒíƒœ ì„¤ì •
	switch(action.type). // Actionê°ì²´ì˜ typeê°’ì— ë”°ë¥¸ ì¡°ê±´ë¬¸
		case 'INCREASE':   // action === 'INCREASE'
			return state + 1;
		case 'DECREASE':   // action === 'DECREASE'
			return state - 1;
		case 'SET_NUMBER': // action === 'SET_NUMBER'
			return action.payload;
		default:  // ìœ„ì˜ ì¡°ê±´ì— ëª¨ë‘ í•´ë‹¹ë˜ì§€ ì•Šì„ ë•Œ ê¸°ì¡´ ìƒíƒœ return
			return state;
} // Reducerê°€ ë¦¬í„´í•˜ëŠ” ê°’ì´ ìƒˆë¡œìš´ ìƒíƒœ!
```

âœ‹Â `Reducer`ê°€ ìˆœìˆ˜í•¨ìˆ˜ì—¬ì•¼ ì™¸ë¶€ ìš”ì¸ìœ¼ë¡œ ì¸í•´ ì—‰ëš±í•œ ê°’ìœ¼ë¡œ ìƒíƒœê°€ ë³€ê²½ë˜ëŠ” ì¼ì´ ì—†ì–´ì§

```jsx
// ì—¬ëŸ¬ ê°œì˜ Reducerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
// combineReduers() ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ í•˜ë‚˜ì˜ Reducerë¡œ í•©ì ¸ì¤„ ìˆ˜ ìˆìŒ
import {combineReduers} from 'redux';

const rootReducer = combineReducers({
	counterReducer,
	anyReduer,
	...
});
```

<br/>

### ğŸ“Â Store

> ìƒíƒœê°€ ê´€ë¦¬ë˜ëŠ” í•˜ë‚˜ë¿ì¸ ì €ì¥ì†Œ ì—­í• 
> ì¦‰, stateê°€ ì €ì¥ë˜ì–´ ìˆëŠ” ê³µê°„

```jsx
import { createStore } from "redux";

const store = createStore(rootReducer);
```

<br/>

### ğŸ“Â Redux Hooks

1. **`useSelector()`**

   : ì»´í¬ë„ŒíŠ¸ & stateë¥¼ ì—°ê²°í•˜ì—¬ Reduxì˜ stateì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë©”ì„œë“œ

   ```jsx
   import { useSelector } from "react-redux"; // 'redux'ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ”ê²Œ ì•„ë‹ˆë¼ëŠ” ê²ƒì— ì£¼ì˜!

   const counter = useSelector((state) => state.counterReducer);
   console.log(counter); // 1
   ```

1. **`useDispatch()`**

   : Action ê°ì²´ë¥¼ Reducerë¡œ ì „ë‹¬í•´ì£¼ëŠ” ë©”ì„œë“œ

   ```jsx
   import { useDispatch } from "react-redux";

   const dispatch = useDispatch();
   dispatch(increase());
   console.log(counter); // 2

   dispatch(setNumber(10));
   console.log(counter); // 10
   ```

<br/>

### ğŸ“Â Redux 3ì›ì¹™

1. `Single source of truth` <br/>
   : ë™ì¼í•œ ë°ì´í„°ëŠ” í•­ìƒ ê°™ì€ ê³³ì—ì„œ ê°€ì§€ê³  ì™€ì•¼ í•¨ <br/>
   ğŸ‘‰ Reduxì—ì„  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í•˜ë‚˜ë¿ì¸ ê³µê°„ì¸ `Store` ì¡´ì¬
2. `State is read-only` <br/>
   : ìƒíƒœëŠ” ì½ê¸° ì „ìš© <br/>
   ğŸ‘‰ Action ê°ì²´ê°€ ìˆì–´ì•¼ë§Œ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥
3. `Changes are mad with pure functions` <br/>
   : ë³€ê²½ì€ ìˆœìˆ˜í•¨ìˆ˜ë¡œë§Œ ê°€ëŠ¥ <br/>
   ğŸ‘‰Â ìƒíƒœê°€ ì—‰ëš±í•œ ê°’ìœ¼ë¡œ ë³€ê²½ë˜ëŠ” ì¼ì´ ì—†ë„ë¡ í•´ì•¼ í•¨

<br/>

---

## â˜‘ï¸Â [Pair] Cmarket Redux

> ì˜¤ëŠ˜ì€ ì–´ì œ êµ¬í˜„í–ˆë˜ Cmarket Hooks ê¸°ëŠ¥ë“¤ì„ Reduxë¥¼ í™œìš©í•˜ì—¬ Refactoringí•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì¡Œë‹¤.

<br/>

### âŒ˜ Action

```jsx
// action types
export const ADD_TO_CART = "ADD_TO_CART";
export const REMOVE_FROM_CART = "REMOVE_FROM_CART";
export const SET_QUANTITY = "SET_QUANTITY";
export const NOTIFY = "NOTIFY";
export const ENQUEUE_NOTIFICATION = "ENQUEUE_NOTIFICATION";
export const DEQUEUE_NOTIFICATION = "DEQUEUE_NOTIFICATION";

// actions creator functions

// ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ACTION
export const addToCart = (itemId) => {
  return {
    type: ADD_TO_CART,
    payload: {
      // payloadë¡œ êµ¬ì²´ì ì¸ ê°’ì„ ì„¤ì •í•´ì£¼ê¸°
      quantity: 1, // ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ë• ìˆ˜ëŸ‰ì´ 1ë¡œ ê³ ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ê°’ì„ 1ë¡œ ì„¤ì •
      itemId,
    },
  };
};

// ì¥ë°”êµ¬ë‹ˆ ì‚­ì œ ACTION
export const removeFromCart = (itemId) => {
  return {
    type: REMOVE_FROM_CART,
    payload: {
      itemId, // ì‚­ì œ actionì‹œì—ëŠ” quantity(ìˆ˜ëŸ‰) ê°’ì€ êµ³ì´ í•„ìš”ì—†ìœ¼ë¯€ë¡œ idë§Œ ê°’ ì„¤ì •!
    },
  };
};

// ìˆ˜ëŸ‰ë³€ê²½ ACTION
export const setQuantity = (itemId, quantity) => {
  return {
    type: SET_QUANTITY,
    payload: {
      itemId,
      quantity,
    },
  };
};

// ...
```

<br/>

### âŒ˜ Dispath

1. **ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€**

   ```jsx
   const handleClick = (item) => {
     // ì¥ë°”êµ¬ë‹ˆì— í´ë¦­í•œ í•´ë‹¹ í’ˆëª©ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´
     if (!cartItems.map((el) => el.itemId).includes(item.id)) {
       dispatch(notify(`ì¥ë°”êµ¬ë‹ˆì— ${item.name}ì´(ê°€) ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`));
       dispatch(addToCart(item.id)); // dispatch()ë¡œ ì•„ì´í…œ ì¶”ê°€ì— ëŒ€í•œ ì•¡ì…˜ ì „ë‹¬
     } else {
       // í´ë¦­í•œ í’ˆëª©ì´ ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ìˆëŠ” í’ˆëª©ì´ë¼ë©´
       dispatch(notify("ì´ë¯¸ ì¶”ê°€ëœ ìƒí’ˆì…ë‹ˆë‹¤."));
     }
   };
   ```

2. **ì¥ë°”êµ¬ë‹ˆì—ì„œ í’ˆëª© ì‚­ì œ**

   ```jsx
   const handleQuantityChange = (quantity, itemId) => {
     dispatch(setQuantity(itemId, quantity)); // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ìˆ˜ëŸ‰ë³€ê²½ ì•¡ì…˜ ì „ë‹¬
   };
   ```

3. **ì¥ë°”êµ¬ë‹ˆì—ì„œ í’ˆëª© ìˆ˜ëŸ‰ ë³€ê²½**

   ```jsx
   const handleDelete = (itemId) => {
     setCheckedItems(checkedItems.filter((el) => el !== itemId));
     dispatch(removeFromCart(itemId)); // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ì‚­ì œ ì•¡ì…˜ ì „ë‹¬
   };
   ```

<br/>

### âŒ˜ Reducer

```jsx
import { REMOVE_FROM_CART, ADD_TO_CART, SET_QUANTITY } from "../actions/index";
import { initialState } from "./initialState"; // dummy data

const itemReducer = (state = initialState, action) => {
  switch (action.type) {
    case ADD_TO_CART:
      return Object.assign({}, state, {
        // Object.assign()ì„ í†µí•´ ìƒˆë¡œìš´ ê°ì²´ ìƒì„±
        // ê¸°ì¡´ ë°ì´í„°ì— ìƒˆë¡œìš´ ë°ì´í„° ì¦‰, action.payloadë¥¼ ë”í•´ì¤Œ
        cartItems: [...state.cartItems, action.payload],
      });

    case REMOVE_FROM_CART:
      // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ idì™€ action.payloadì˜ idë¥¼ ë¹„êµí•´ì„œ ê±°ë¥¸ ì•„ì´í…œ
      let deletedItem = state.cartItems.filter(
        (el) => el.itemId !== action.payload.itemId
      );
      return Object.assign({}, state, {
        cartItems: deletedItem, // ê±°ë¥¸ ì‚­ì œí•  ì•„ì´í…œì„ cartItemsë¡œ.
      });

    case SET_QUANTITY:
      // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ idì™€ action.payloadì˜ idê°€ ê°™ì„ ë•Œì˜ í•´ë‹¹ ì•„ì´í…œì˜ index
      let idx = state.cartItems.findIndex(
        (el) => el.itemId === action.payload.itemId
      );

      return Object.assign({}, state, {
        // ìˆ˜ì •í•  ì•„ì´í…œ ì „, í›„ëŠ” ê¸°ì¡´ ë°ì´í„°ë¡œ ìœ ì§€í•˜ë˜,
        // ìˆ˜ì •í•  ì•„ì´í…œì¸ action.payloadë¥¼ ê·¸ ì¤‘ê°„ì— ë¼ì›Œì„œ ë”í•´ì¤Œ
        // ì´ ë¸”ë¡œê·¸ì—ì„œ ë°©ë²• ì•„ì´ë””ì–´ ì–»ìŒ! -> https://florescene.tistory.com/m/199
        cartItems: [
          ...state.cartItems.slice(0, idx), //
          action.payload,
          ...state.cartItems.slice(idx + 1),
        ],
      });
    default:
      return state;
  }
};

export default itemReducer;
```

<br/>

ğŸ«  **Reducerì˜ ë¶ˆë³€ì„±(Immutability)** <br/>
: Reduxì˜ state ì—…ë°ì´íŠ¸ëŠ” immutableí•œ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•¨ <br/>
Â  ğŸ¤·â€â™€ï¸Â why? Redux ì¥ì  ì¤‘ í•˜ë‚˜ì¸ ë³€ê²½ëœ stateë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¸°ê¸° ìœ„í•´ <br/>
Â  ğŸ‘‰Â `Object.assign()`ì„ í†µí•´ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë¦¬í„´! (spread ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•œ ê¸°ëŠ¥)

<br/>

â° Test 12/12 Pass âœŒï¸

<img width="813" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-06 á„‹á…©á„’á…® 11 58 04" src="https://user-images.githubusercontent.com/64299610/177588122-fbecd66a-79fe-417f-b4f9-b820edc24b1f.png">

<br/>

---

> ì–´ì œë„ ê·¸ë ‡ê³ , ì˜¤ëŠ˜ë„ ì €ë…ì— ì™¸ì‹ì„ í•´ì„œ ì €ë… ì‹œê°„ì— ê³µë¶€ëŸ‰ì´ í˜„ì €íˆ ì¤„ì–´ë“¤ì—ˆë‹¤.ğŸ¥² <br/>
> ì–´ì   ì•„ì˜ˆ ëª»í–ˆêµ¬, ì˜¤ëŠ˜ë„ ì§‘ì˜¤ë‹ˆê¹Œ ì¡¸ë¦¬ê³  í”¼ê³¤í•´ì„œ ì§‘ì¤‘ì´ ì•ˆë˜ëŠ” ëŠë‚Œì“°.. <br/>
> ë‚´ì¼ í•˜ë£¨ë„ íì§€ë¶€ì§€ ë³´ë‚´ì§€ ë§ê¸° ğŸ™ <br/>
> ê·¸ë¦¬ê³  ê³„ì† ê³ ë¯¼í•˜ê³  ê³ ë¯¼í–ˆë˜ `ëª¨ë˜ììŠ¤ ë”¥ë‹¤ì´ë¸Œ` ë„ì„œë¥¼ ebookìœ¼ë¡œ êµ¬ë§¤í–ˆë‹¤. 10ì›”ê¹Œì§€ ë¶€ì§€ëŸ°íˆ ì½ì–´ë³´ì ğŸ¦¾
